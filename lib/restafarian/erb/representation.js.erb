"use strict";

var Resource = {};

Resource.label = "<%= object_name %>";

Resource.persisted = <%= object.persisted? %>;

Resource.properties = <%= JSON.pretty_generate(object_typed_properties, indent: '  ') %>;

Resource.errors = <%= JSON.pretty_generate(I18n.t('errors.messages'), indent: '  ') %>;

Resource.validators = {
  "presence": function(property, options) {
    if(!this[property]) return ['blank', null];
  },

  "absence": function(property, value) {
    if(this[property]) return ['present', null];
  },

  "length": function(property, options) {
    property = this[property];

    if(options.minimum && property.length < options.minimum) return ['too_short', 'minimum'];
    if(options.maximum && property.length > options.maximum) return ['too_long',  'maximum'];
  },

  "acceptance": function(property, options) {},

  "inclusion": function(property, options) {},

  "confirmation": function(property, options) {},

  "numericality": function(property, options) {}
}

Resource.error = function(error, key, options) {
  var message = this.errors[error];
  return message.replace("%{count}", options[key]);
}

Resource.validate = function(representation) {
  var errors = {};

  for(var property in this.properties) {
    errors[property] = [];

    for(var validator in this.properties[property].validators) {
      var options = this.properties[property].validators[validator];
      var error = this.validators[validator].call(representation, property, options);


      if(error) {
        error.push(options)
        var message = options.message || this.error.apply(this, error);
        errors[property].push(message);
      }
    }
  }

  return errors;
}
